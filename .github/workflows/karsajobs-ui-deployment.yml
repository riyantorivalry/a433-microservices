name: Karsajobs UI Deployment
on: [push, pull_request]

jobs:
  lint-dockerfile:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Install and Run hadolint
      run: |
        sudo wget -O /bin/hadolint https://github.com/hadolint/hadolint/releases/download/v2.7.0/hadolint-Linux-x86_64
        sudo chmod +x /bin/hadolint
        hadolint Dockerfile

   build-app-karsajobs-ui:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 14

    - name: Install Dependencies
      run: npm install

    - name: Build and Push Docker Image
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin ghcr.io
        docker buildx create --use
        docker buildx build --platform linux/amd64,linux/arm64 -t ghcr.io/riyantorivalry/karsajobs-ui:latest .
        docker push ghcr.io/riyantorivalry/karsajobs-ui:latest
